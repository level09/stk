---
title: "Deployment"
description: "Deploy your stk application to production"
sidebarTitle: "Deployment"
---

## Overview

stk provides multiple deployment options. Use the automated VPS deploy for quick Ubuntu setups, or follow the traditional process for other environments.

## Automated VPS Deploy

One command to deploy on any Ubuntu VPS (Hetzner, DigitalOcean, etc.):

```bash
curl -sSL https://raw.githubusercontent.com/level09/ignite/main/ignite.sh | sudo DOMAIN=your-domain.com bash
```

Handles Caddy (auto SSL), Python 3.13, Redis, systemd services. See [Ignite](https://github.com/level09/ignite).

## Traditional Deployment

### Prerequisites

1. Python 3.11+
2. Nginx
3. uv (fast Python package installer)

**Optional:**
- PostgreSQL (SQLite works by default)
- Redis (for session store)

### Server Setup

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install core dependencies
sudo apt install -y python3-pip nginx
pip install uv

# Optional: PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# Optional: Redis (for sessions)
sudo apt install -y redis-server
```

### Application Setup

```bash
git clone https://github.com/level09/stk.git
cd stk
./setup.sh                # Install deps + generate secure .env
uv sync --extra full      # Add asyncpg + Redis
uv run quart create-db    # Setup database
uv run quart install      # Create admin user
```

### Database Configuration

#### SQLite (Default)
Works out of the box, database created automatically in `instance/`.

#### PostgreSQL
```bash
# Create database
sudo -u postgres createuser -s myuser
sudo -u postgres createdb mydb

# Update .env
SQLALCHEMY_DATABASE_URI=postgresql+asyncpg://myuser:password@localhost/mydb

# Initialize
uv run quart create-db
uv run quart install
```

### Nginx Configuration

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    location /static {
        alias /path/to/stk/stk/static;
        expires 30d;
    }
}
```

### SSL Configuration

```bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d yourdomain.com
```

### Systemd Service

Create `/etc/systemd/system/stk.service`:

```ini
[Unit]
Description=stk Web Application
After=network.target

[Service]
User=your_user
WorkingDirectory=/path/to/stk
Environment="PATH=/path/to/stk/.venv/bin"
ExecStart=/path/to/stk/.venv/bin/uvicorn run:app --host 127.0.0.1 --port 5000

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable stk
sudo systemctl start stk
```

## Production Checklist

- [ ] Set `QUART_DEBUG=0` in `.env`
- [ ] Use a secure `SECRET_KEY` (generated by setup.sh)
- [ ] Use `postgresql+asyncpg://` for database
- [ ] Configure proper logging
- [ ] Set up monitoring (e.g., Sentry)
- [ ] Set secure cookie flags (`SESSION_COOKIE_SECURE=True`)
- [ ] Enable HTTPS via Nginx + Certbot
- [ ] Nginx serves `/static` directly

## Troubleshooting

1. **Static files not found (404)**
   - Check Nginx static file path configuration
   - Verify file permissions

2. **Database connection errors**
   - Verify database credentials in `.env`
   - Ensure DSN uses `postgresql+asyncpg://` (not `postgresql://`)
   - Check database service status

3. **Application not starting**
   - Check systemd service logs: `sudo journalctl -u stk`
   - Verify environment variables
   - Check application logs

4. **WebSocket not connecting**
   - Ensure Nginx has `proxy_http_version 1.1` and `Upgrade` headers
   - Check that `/ws` path is proxied correctly
